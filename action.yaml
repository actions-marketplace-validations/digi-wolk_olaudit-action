name: 'OSS License Auditor'
author: '@prazian'
description: 'Runs the OSS license auditor (olAudit) to find risky licenses in your code'

branding:
  icon: check-circle
  color: green

runs:
  using: 'docker'
  image: 'docker://prazian/oss-license-audit:0.0.1'
  env:
    # This information is needed for commenting on the Pull Request on Github.
    # The default Github token used by Github Action is limited to the scope of the current repository, and it will be
    # invalidated after the job is done.
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    GITHUB_REPOSITORY_OWNER: ${{ github.repository_owner }}
    GITHUB_REPOSITORY: ${{ github.repository }}
    GITHUB_PULL_REQUEST_NUMBER: ${{ github.event.number }}
  args:
    - '--ci'
    - '--path ' ${{ inputs.path }}
    - ${{ if eq(inputs.only-risky, 'true') }}'--only-risky'${{ endif }}
    - ${{ if eq(inputs.fail-on-risky-fail, 'true') }}'--fail-on-risky'${{ endif }}
    - ${{ if eq(inputs.comment-on-github-pr, 'true') }}'--comment-on-github-pr'${{ endif }}

inputs:
  path:
    description: 'Path to check'
    required: true
    default: '.'
    deprecationMessage: 'Specify the path to check. Default is current directory.'
  only-risky:
    description: 'Only risky licenses'
    required: false
  fail-on-risky-fail:
    description: 'Fail if risky licenses that are supposed to fail are found'
    required: false
  comment-on-github-pr:
    description: 'Comment findings on the Pull Request on Github'
    required: false
